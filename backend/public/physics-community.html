<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Community - IG Nation</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/vendor.css">
    <link rel="stylesheet" type="text/css" href="style.css?v=4">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;600;700&family=Roboto+Slab&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <style>
        body {
            background-color: transparent;
            font-family: 'Jost', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* Global Smooth Transitions */
        * {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Smooth Scroll Behavior */
        html {
            scroll-behavior: smooth;
            margin: 0;
            padding: 0;
        }

        /* Fade In Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Intersection Observer Animation Classes */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .animate-on-scroll.animated {
            opacity: 1;
            transform: translateY(0);
        }

        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        .floating-delayed {
            animation: float 6s ease-in-out infinite;
            animation-delay: 3s;
        }

        /* Gradient Text Animation */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .gradient-text {
            background: linear-gradient(-45deg, #667eea, #764ba2, #ffd700, #ffed4e);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }

        /* Consistent Card Shadows */
        .unified-card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .unified-card:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        /* Consistent Button Styles */
        .unified-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .unified-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .unified-button:hover::before {
            left: 100%;
        }

        .unified-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        /* Main App Container */
        .app-container {
            height: 100vh;
            width: 100vw;
            background: #f8fafc;
            position: relative;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
        }

        /* Chat Container - Full Dimensions */
        .chat-container {
            background: white;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* Chat Header */
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .chat-info {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-3px);
        }

        .chat-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .chat-details h4 {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            margin: 0;
            line-height: 1.3;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .chat-details p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            line-height: 1.3;
        }

        .online-indicator {
            color: #ffd700;
            font-weight: 600;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            backdrop-filter: blur(10px);
        }

        .chat-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chat-btn iconify-icon {
            font-size: 1.4rem;
        }

        /* Messages Container - Full Height */
        .messages-container {
            flex: 1;
            background: #f8fafc;
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(102, 126, 234, 0.03) 2px, transparent 2px),
                radial-gradient(circle at 75px 75px, rgba(118, 75, 162, 0.03) 2px, transparent 2px);
            background-size: 100px 100px;
            overflow-y: auto;
            padding: 20px 30px 30px 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 10px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        /* Welcome Message */
        .welcome-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 600px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 40px;
            line-height: 1.6;
            max-width: 500px;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 25px 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .feature-text {
            font-size: 0.95rem;
            font-weight: 600;
            color: #1e293b;
            text-align: center;
        }

        /* Messages List */
        .messages-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Date Separator */
        .date-separator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .date-badge {
            background: white;
            color: #64748b;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        /* Message Styles */
        .message {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            animation: fadeInUp 0.5s ease-out;
            max-width: 80%;
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
            max-width: 75%;
        }

        .message.received {
            align-self: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .message.sent .message-avatar {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1e293b;
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sender-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #64748b;
            margin-left: 10px;
        }

        .message.sent .sender-name {
            text-align: right;
            margin-right: 10px;
            margin-left: 0;
        }

        .message-bubble {
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            word-wrap: break-word;
        }

        .message.sent .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .message.sent .message-bubble::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: -8px;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-left-color: #667eea;
            border-bottom: 0;
        }

        .message.received .message-bubble::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -8px;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-right-color: white;
            border-bottom: 0;
        }

        .message-text {
            margin: 0;
            font-size: 1rem;
            line-height: 1.5;
            color: #1e293b;
        }

        .message.sent .message-text {
            color: white;
        }

        .message-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .message.sent .message-meta {
            justify-content: flex-end;
            color: rgba(255, 255, 255, 0.9);
        }

        .message-time {
            color: #94a3b8;
        }

        .read-status {
            color: #ffd700;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
            width: fit-content;
            max-width: 150px;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .typing-text {
            font-size: 0.85rem;
            color: #64748b;
            margin-left: 10px;
        }

        /* Message Input Container */
        .message-input-container {
            background: white;
            padding: 20px 30px;
            border-top: 1px solid rgba(102, 126, 234, 0.1);
            display: flex;
            align-items: flex-end;
            gap: 15px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.05);
        }

        .input-btn {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
            flex-shrink: 0;
        }

        .input-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .input-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .input-btn iconify-icon {
            font-size: 1.4rem;
        }

        .message-input {
            flex: 1;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 25px;
            padding: 15px 25px;
            font-size: 1rem;
            font-family: 'Jost', sans-serif;
            resize: none;
            outline: none;
            transition: all 0.3s ease;
            min-height: 45px;
            max-height: 120px;
        }

        .message-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .message-input::placeholder {
            color: #94a3b8;
        }

        /* File Message Styles */
        .file-message {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .file-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .file-size {
            font-size: 0.85rem;
            color: #64748b;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                height: 100vh;
                width: 100vw;
                margin: 0;
                padding: 0;
            }

            .chat-container {
                height: 100vh;
                width: 100vw;
                margin: 0;
                padding: 0;
            }

            .chat-header {
                padding: 12px 20px;
            }

            .messages-container {
                padding: 15px 20px 20px 20px;
            }

            .message {
                max-width: 90%;
            }

            .message.sent {
                max-width: 85%;
            }

            .welcome-container {
                margin: 15px auto;
                padding: 30px 20px;
            }

            .welcome-features {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- Chat Container - Full Dimensions -->
        <div class="chat-container" id="chatContainer">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-info">
                    <button class="back-btn" onclick="goBack()" title="Go Back">
                        <iconify-icon icon="material-symbols:arrow-back"></iconify-icon>
                    </button>
                    <div class="chat-avatar">⚛️</div>
                    <div class="chat-details">
                        <h4>Physics IGCSE Community</h4>
                        <p id="chatStatus">
                            Study together, learn better
                            <span class="online-indicator" id="onlineCount">142 online</span>
                        </p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-btn" onclick="showMembers()" title="View Members">
                        <iconify-icon icon="material-symbols:group"></iconify-icon>
                    </button>
                    <button class="chat-btn" onclick="openSearch()" title="Search Messages">
                        <iconify-icon icon="material-symbols:search"></iconify-icon>
                    </button>
                    <button class="chat-btn" onclick="openFileUpload()" title="Upload File">
                        <iconify-icon icon="material-symbols:attach-file"></iconify-icon>
                    </button>
                    <button class="chat-btn" onclick="openMenu()" title="More Options">
                        <iconify-icon icon="material-symbols:more-vert"></iconify-icon>
                    </button>
                </div>
            </div>
            
            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Message -->
                <div class="welcome-container" id="welcomeContainer">
                    <div class="welcome-icon">⚛️</div>
                    <div class="welcome-title">Welcome to Physics Community!</div>
                    <div class="welcome-subtitle">Connect with fellow physics students, ask questions, share resources, and learn together in a supportive environment.</div>
                    <div class="welcome-features">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <iconify-icon icon="material-symbols:chat"></iconify-icon>
                            </div>
                            <div class="feature-text">Ask Questions</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <iconify-icon icon="material-symbols:school"></iconify-icon>
                            </div>
                            <div class="feature-text">Share Resources</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <iconify-icon icon="material-symbols:group"></iconify-icon>
                            </div>
                            <div class="feature-text">Study Groups</div>
                        </div>
                    </div>
                </div>
                
                <!-- Messages List -->
                <div class="messages-list" id="messagesList" style="display: none;">
                    <!-- Messages will be inserted here -->
                </div>
            </div>

            <!-- Message Input Container -->
            <div class="message-input-container">
                <button class="input-btn" onclick="openFileUpload()" title="Attach File">
                    <iconify-icon icon="material-symbols:attach-file"></iconify-icon>
                </button>
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Type a message..."
                    rows="1"
                    onkeydown="handleKeyPress(event)"
                    oninput="handleInput(event)"
                ></textarea>
                <button class="input-btn" onclick="sendMessage()" id="sendBtn" title="Send Message" disabled>
                    <iconify-icon icon="material-symbols:send"></iconify-icon>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Physics Community functionality
        let messages = [];
        let members = [];
        let isTyping = false;
        let typingTimer;
        let messageId = 1000;
        let selectedFile = null;

        // Sample members data
        const sampleMembers = [
            { id: 1, name: "Dr. Sarah Ahmed", role: "Physics Teacher", avatar: "SA", online: true },
            { id: 2, name: "Ahmed Hassan", role: "Student", avatar: "AH", online: true },
            { id: 3, name: "Layla Mohammed", role: "Student", avatar: "LM", online: false },
            { id: 4, name: "Omar Ali", role: "Student", avatar: "OA", online: true },
            { id: 5, name: "Fatima Khalil", role: "Student", avatar: "FK", online: true },
            { id: 6, name: "Hassan Ibrahim", role: "Student", avatar: "HI", online: false }
        ];

        // Sample messages data
        const sampleMessages = [
            {
                id: 1,
                sender: "Dr. Sarah Ahmed",
                avatar: "SA",
                text: "Good morning everyone! Today we'll be covering Newton's Laws of Motion. Make sure you have your physics notebooks ready.",
                time: "09:15 AM",
                type: "received",
                timestamp: Date.now() - 3600000
            },
            {
                id: 2,
                sender: "You",
                avatar: "ME",
                text: "Good morning Dr. Sarah! I have a question about yesterday's homework on forces.",
                time: "09:17 AM",
                type: "sent",
                timestamp: Date.now() - 3580000
            },
            {
                id: 3,
                sender: "Ahmed Hassan",
                avatar: "AH",
                text: "Can we review the free body diagrams again? I'm still confused about the normal force.",
                time: "09:18 AM",
                type: "received",
                timestamp: Date.now() - 3570000
            },
            {
                id: 4,
                sender: "Dr. Sarah Ahmed",
                avatar: "SA",
                text: "Of course! Let me share a detailed explanation in the resources section. I'll also post some practice problems with solutions.",
                time: "09:20 AM",
                type: "received",
                timestamp: Date.now() - 3550000
            },
            {
                id: 5,
                sender: "Layla Mohammed",
                avatar: "LM",
                text: "Thank you Dr. Sarah! The explanations are very helpful 🙏 Can we have a study session this weekend?",
                time: "09:22 AM",
                type: "received",
                timestamp: Date.now() - 3530000
            },
            {
                id: 6,
                sender: "You",
                avatar: "ME",
                text: "I finished the assignment on momentum. Where should I submit it?",
                time: "09:25 AM",
                type: "sent",
                timestamp: Date.now() - 3500000
            },
            {
                id: 7,
                sender: "Dr. Sarah Ahmed",
                avatar: "SA",
                text: "Great! You can submit it through the assignments section in your dashboard. The deadline is tomorrow at 11:59 PM.",
                time: "09:27 AM",
                type: "received",
                timestamp: Date.now() - 3480000
            }
        ];

        // Initialize
        function initializePhysicsCommunity() {
            messages = [...sampleMessages];
            members = [...sampleMembers];
            renderMessages();
            updateOnlineCount();
            checkQuestionDraft();
            initializeAnimations();
            
            // Simulate periodic activity
            setInterval(() => {
                if (Math.random() < 0.3) {
                    simulateActivity();
                }
            }, 30000);
        }

        // Initialize animations
        function initializeAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animated');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.animate-on-scroll').forEach(el => {
                observer.observe(el);
            });
        }


        function getCurrentTime() {
            return new Date().toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function renderMessages() {
            const messagesList = document.getElementById('messagesList');
            const welcomeContainer = document.getElementById('welcomeContainer');
            
            if (messages.length === 0) {
                welcomeContainer.style.display = 'flex';
                messagesList.style.display = 'none';
                return;
            }
            
            welcomeContainer.style.display = 'none';
            messagesList.style.display = 'flex';
            
            // Add date separator
            messagesList.innerHTML = `
                <div class="date-separator">
                    <div class="date-badge">Today</div>
                </div>
            `;
            
            messages.forEach(msg => {
                const messageEl = createMessageElement(msg);
                messagesList.appendChild(messageEl);
            });
            
            scrollToBottom();
        }

        function createMessageElement(msg) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${msg.type}`;
            messageDiv.setAttribute('data-message-id', msg.id);
            
            const isFileMessage = msg.file;
            const messageContent = isFileMessage ? createFileMessageContent(msg) : msg.text;
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${msg.avatar}</div>
                <div class="message-content">
                    ${msg.type === 'received' ? `<div class="sender-name">${msg.sender}</div>` : ''}
                    <div class="message-bubble">
                        ${messageContent}
                        <div class="message-meta">
                            <span class="message-time">${msg.time}</span>
                            ${msg.type === 'sent' ? `<span class="read-status"><iconify-icon icon="material-symbols:done-all"></iconify-icon></span>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            return messageDiv;
        }

        function createFileMessageContent(msg) {
            return `
                <div class="file-message">
                    <div class="file-icon">
                        <iconify-icon icon="material-symbols:description"></iconify-icon>
                    </div>
                    <div class="file-info">
                        <div class="file-name">${msg.file.name}</div>
                        <div class="file-size">${formatFileSize(msg.file.size)}</div>
                    </div>
                    <button class="download-btn" onclick="downloadFile('${msg.file.name}')">Download</button>
                </div>
            `;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function downloadFile(fileName) {
            alert(`📁 Downloading ${fileName}...\n\nNote: This is a demo. In a real app, this would download the actual file.`);
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text && !selectedFile) return;
            
            const newMessage = {
                id: ++messageId,
                sender: "You",
                avatar: "ME",
                text: text || (selectedFile ? `📎 Uploaded file: ${selectedFile.name}` : ''),
                time: getCurrentTime(),
                type: "sent",
                timestamp: Date.now(),
                file: selectedFile ? {
                    name: selectedFile.name,
                    size: selectedFile.size,
                    type: selectedFile.type,
                    url: URL.createObjectURL(selectedFile)
                } : null
            };
            
            messages.push(newMessage);
            renderMessages();
            
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('sendBtn').disabled = true;
            selectedFile = null;
            
            // Simulate AI response
            setTimeout(() => {
                simulateBotResponse();
            }, 1500);
        }

        function handleInput(event) {
            const input = event.target;
            const sendBtn = document.getElementById('sendBtn');
            
            input.style.height = 'auto';
            input.style.height = Math.min(input.scrollHeight, 120) + 'px';
            
            sendBtn.disabled = !input.value.trim() && !selectedFile;
            
            if (input.value.trim()) {
                startTyping();
            } else {
                stopTyping();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function startTyping() {
            if (!isTyping) {
                isTyping = true;
                console.log('User started typing...');
            }
            clearTimeout(typingTimer);
            typingTimer = setTimeout(stopTyping, 1000);
        }

        function stopTyping() {
            if (isTyping) {
                isTyping = false;
                console.log('User stopped typing...');
            }
        }

        function simulateBotResponse() {
            const responses = [
                "Great question! Let me help you with that.",
                "That's a common misconception. Here's the correct explanation...",
                "I can see you're working hard on this topic. Keep it up!",
                "Let me share some additional resources that might help.",
                "Excellent work! You're making good progress.",
                "I'll post a detailed explanation in the resources section.",
                "Feel free to ask if you need any clarification.",
                "This is a great example of applying physics concepts!"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const botMessage = {
                id: ++messageId,
                sender: "Dr. Sarah Ahmed",
                avatar: "SA",
                text: randomResponse,
                time: getCurrentTime(),
                type: "received",
                timestamp: Date.now()
            };
            
            messages.push(botMessage);
            renderMessages();
        }

        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        function updateOnlineCount() {
            const onlineMembers = members.filter(member => member.online);
            document.getElementById('onlineCount').textContent = `${onlineMembers.length} online`;
        }

        function simulateActivity() {
            const randomMembers = members.filter(m => m.online && m.name !== "You");
            if (randomMembers.length > 0) {
                const randomMember = randomMembers[Math.floor(Math.random() * randomMembers.length)];
                const activities = [
                    "joined the community",
                    "is studying Newton's Laws",
                    "shared a physics resource",
                    "asked a question about forces",
                    "completed an assignment"
                ];
                
                const activity = activities[Math.floor(Math.random() * activities.length)];
                console.log(`${randomMember.name} ${activity}`);
            }
        }

        // Simple working functions
        function openSearch() {
            const query = prompt('🔍 Search in messages:');
            if (query && query.trim()) {
                const results = messages.filter(msg => 
                    msg.text.toLowerCase().includes(query.toLowerCase()) ||
                    msg.sender.toLowerCase().includes(query.toLowerCase())
                );
                
                if (results.length > 0) {
                    let resultText = `Found ${results.length} message(s):\n\n`;
                    results.forEach((msg, index) => {
                        resultText += `${index + 1}. ${msg.sender}: ${msg.text.substring(0, 60)}...\n`;
                    });
                    alert(resultText);
                } else {
                    alert('No messages found matching your search.');
                }
            }
        }
        
        function openFileUpload() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.mp4,.txt,.ppt,.pptx';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 10 * 1024 * 1024) {
                        alert('File size must be less than 10MB');
                        return;
                    }
                    
                    selectedFile = file;
                    document.getElementById('sendBtn').disabled = false;
                    
                    const fileMessage = {
                        id: ++messageId,
                        sender: "You",
                        avatar: "ME",
                        text: `📎 Uploaded file: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`,
                        time: getCurrentTime(),
                        type: "sent",
                        timestamp: Date.now(),
                        file: {
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            url: URL.createObjectURL(file)
                        }
                    };
                    
                    messages.push(fileMessage);
                    renderMessages();
                    
                    setTimeout(() => {
                        const response = {
                            id: ++messageId,
                            sender: "Dr. Sarah Ahmed",
                            avatar: "SA",
                            text: `File "${file.name}" received successfully! I'll review it and provide feedback. 📁`,
                            time: getCurrentTime(),
                            type: "received",
                            timestamp: Date.now()
                        };
                        messages.push(response);
                        renderMessages();
                    }, 1500);
                }
            };
            input.click();
        }
        
        function openMenu() {
            const options = [
                '🔔 Notification Settings',
                '⚙️ Community Settings', 
                '📥 Export Chat History',
                '🗑️ Clear Chat History',
                '👥 View Members',
                '📚 Study Resources',
                '❓ Help & Support'
            ];
            
            const choice = prompt(`Choose an option:\n\n${options.map((opt, i) => `${i + 1}. ${opt}`).join('\n')}\n\nEnter number (1-7):`);
            
            switch(choice) {
                case '1':
                    alert('🔔 Notification Settings\n\n• Enable desktop notifications\n• Sound alerts for new messages\n• Email notifications\n• Mobile push notifications\n\nSettings panel coming soon!');
                    break;
                case '2':
                    alert('⚙️ Community Settings\n\n• Theme preferences (Light/Dark)\n• Message display options\n• Privacy settings\n• Language preferences\n\nSettings panel coming soon!');
                    break;
                case '3':
                    if (messages.length === 0) {
                        alert('No messages to export.');
                        return;
                    }
                    const chatData = {
                        community: 'Physics IGCSE Community',
                        exportDate: new Date().toISOString(),
                        messageCount: messages.length,
                        messages: messages.map(msg => ({
                            sender: msg.sender,
                            text: msg.text,
                            time: msg.time,
                            timestamp: msg.timestamp
                        }))
                    };
                    const dataStr = JSON.stringify(chatData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `physics-community-chat-${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    alert('✅ Chat history exported successfully!');
                    break;
                case '4':
                    if (confirm('Are you sure you want to clear all chat history?')) {
                        messages = [];
                        renderMessages();
                        document.getElementById('welcomeContainer').style.display = 'flex';
                        document.getElementById('messagesList').style.display = 'none';
                        alert('🗑️ Chat history cleared successfully!');
                    }
                    break;
                case '5':
                    showMembers();
                    break;
                case '6':
                    alert('📚 Study Resources\n\n• Physics formulas and equations\n• Practice problems with solutions\n• Video explanations\n• Interactive simulations\n• Past exam papers\n\nResources section coming soon!');
                    break;
                case '7':
                    alert('❓ Help & Support\n\n📝 How to use:\n• Type messages and press Enter to send\n• Click the attachment button to share files\n• Use the search button to find messages\n• Click the group button to see online members\n\n🔧 Features:\n• Real-time messaging\n• File sharing (PDF, DOC, images, videos)\n• Message search\n• Chat export\n• Study resources\n\n📞 Need more help? Contact support@ignation.com');
                    break;
                default:
                    alert('Invalid choice. Please try again.');
            }
        }

        function showMembers() {
            const onlineMembers = members.filter(m => m.online);
            const offlineMembers = members.filter(m => !m.online);
            
            let memberText = `👥 Physics Community Members (${members.length} total)\n\n`;
            
            if (onlineMembers.length > 0) {
                memberText += `🟢 Online (${onlineMembers.length}):\n`;
                onlineMembers.forEach(member => {
                    memberText += `• ${member.name} (${member.role})\n`;
                });
                memberText += '\n';
            }
            
            if (offlineMembers.length > 0) {
                memberText += `⚪ Offline (${offlineMembers.length}):\n`;
                offlineMembers.forEach(member => {
                    memberText += `• ${member.name} (${member.role})\n`;
                });
            }
            
            alert(memberText);
        }

        function goBack() {
            if (confirm('Are you sure you want to leave the Physics Community?')) {
                window.history.back();
            }
        }

        // Check for question draft from assignment/quiz/exam
        function checkQuestionDraft() {
            const draft = localStorage.getItem('communityQuestionDraft');
            if (draft) {
                try {
                    const question = JSON.parse(draft);
                    const messageInput = document.getElementById('messageInput');
                    
                    // Format question for community post
                    let questionText = `📝 Question from ${question.source}:\n\n${question.text}`;
                    
                    if (question.options && question.options.length > 0) {
                        questionText += '\n\nOptions:';
                        question.options.forEach((opt, idx) => {
                            questionText += `\n${String.fromCharCode(65 + idx)}. ${opt}`;
                        });
                    }
                    
                    questionText += '\n\nCan someone help me understand this?';
                    
                    // Pre-fill the message input
                    messageInput.value = questionText;
                    messageInput.style.height = 'auto';
                    messageInput.style.height = (messageInput.scrollHeight) + 'px';
                    messageInput.focus();
                    
                    // Clear the draft
                    localStorage.removeItem('communityQuestionDraft');
                    
                    console.log('✅ Physics question loaded from assignment/quiz/exam');
                } catch (e) {
                    console.error('Error loading question draft:', e);
                    localStorage.removeItem('communityQuestionDraft');
                }
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializePhysicsCommunity();
            console.log('Physics Community loaded successfully with professional design!');
        });
    </script>
</body>
</html>