<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mathematics Homework - IG Nation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.css">
  <style>
    /* âœ… Your same styles kept exactly */
    * { box-sizing: border-box; }
    html, body { margin:0!important; padding:0!important; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#F8F8F8; min-height:100vh; }
    .homework-header { background:rgba(255,255,255,0.95); backdrop-filter:blur(20px); box-shadow:0 8px 32px rgba(0,0,0,0.1); border-bottom:1px solid rgba(255,255,255,0.2); padding:1rem 2rem; position:fixed; top:0; left:0; right:0; z-index:1000; display:flex; justify-content:space-between; align-items:center; }
    .homework-logo { display:flex; align-items:center; text-decoration:none; color:#333; }
    .homework-logo img { height:35px; margin-right:.75rem; filter:drop-shadow(0 2px 4px rgba(0,0,0,.1)); transition:.3s; }
    .homework-logo:hover img { transform:scale(1.05); }
    .subject-badge { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:.25rem .75rem; border-radius:20px; font-size:.8rem; font-weight:600; margin-left:1rem; }
    .homework-nav { display:flex; gap:1rem; align-items:center; }
    .nav-btn { background:white; border:1px solid #e9ecef; border-radius:8px; padding:.5rem 1rem; color:#333; text-decoration:none; font-weight:500; transition:.3s; display:flex; align-items:center; gap:.5rem; }
    .nav-btn:hover { background:#667eea; color:white; transform:translateY(-2px); box-shadow:0 4px 12px rgba(102,126,234,0.3); }
    .main-content { margin-top:100px; padding:2rem; }
    .homework-hero { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:3rem; border-radius:12px; margin-bottom:2rem; text-align:center; }
    .homework-title { font-size:3rem; font-weight:700; margin-bottom:1rem; }
    .homework-subtitle { font-size:1.2rem; opacity:.9; margin-bottom:2rem; }
    .homework-stats { display:flex; justify-content:center; gap:3rem; margin-top:2rem; }
    .stat-item { text-align:center; }
    .stat-number { font-size:2.5rem; font-weight:700; margin-bottom:.5rem; }
    .stat-label { font-size:1rem; opacity:.8; }
    .homework-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:2rem; margin-bottom:2rem; }
    .homework-card { background:white; border-radius:12px; padding:2rem; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:.3s; border-left:4px solid #667eea; }
    .homework-card:hover { transform:translateY(-4px); box-shadow:0 8px 24px rgba(0,0,0,0.12); }
    .homework-card-header { display:flex; align-items:center; margin-bottom:1rem; }
    .homework-icon { width:50px; height:50px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-right:1rem; font-size:1.5rem; color:white; background:linear-gradient(135deg,#27ae60 0%,#2ecc71 100%); }
    .homework-card-title { font-size:1.25rem; font-weight:700; color:#333; margin-bottom:.5rem; }
    .homework-card-description { color:#666; margin-bottom:1.5rem; line-height:1.6; }
    .homework-details { background:#f8f9fa; border-radius:8px; padding:1rem; margin-bottom:1.5rem; }
    .detail-row { display:flex; justify-content:space-between; margin-bottom:.5rem; }
    .detail-label { font-weight:600; color:#333; }
    .detail-value { color:#666; }
    .homework-actions { display:flex; gap:1rem; }
    .btn-primary { background:linear-gradient(135deg,#27ae60 0%,#2ecc71 100%); border:none; border-radius:8px; padding:.75rem 1.5rem; color:white; font-weight:600; transition:.3s; flex:1; }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(39,174,96,0.3); }
    .btn-outline { background:transparent; border:2px solid #27ae60; border-radius:8px; padding:.75rem 1.5rem; color:#27ae60; font-weight:600; transition:.3s; flex:1; }
    .btn-outline:hover { background:#27ae60; color:white; }
    .status-badge { display:inline-block; padding:.25rem .75rem; border-radius:20px; font-size:.8rem; font-weight:600; margin-bottom:1rem; }
    .status-pending { background:#fff3cd; color:#856404; }
    .status-completed { background:#d4edda; color:#155724; }
    .status-overdue { background:#f8d7da; color:#721c24; }
    .homework-filters { background:white; border-radius:12px; padding:1.5rem; margin-bottom:2rem; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .filter-tabs { display:flex; gap:1rem; margin-bottom:1rem; }
    .filter-tab { padding:.5rem 1rem; border:none; background:transparent; color:#666; font-weight:500; border-radius:6px; cursor:pointer; transition:.3s; }
    .filter-tab.active { background:#27ae60; color:white; }
    .filter-tab:hover { background:#f8f9fa; }
    .filter-tab.active:hover { background:#2ecc71; }
    .search-box { position:relative; }
    .search-input { width:100%; padding:.75rem 1rem .75rem 3rem; border:1px solid #e9ecef; border-radius:8px; font-size:1rem; }
    .search-icon { position:absolute; left:1rem; top:50%; transform:translateY(-50%); color:#666; }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="homework-header">
    <a href="course-mathematics.html" class="homework-logo">
      <img src="images/ig-nation-logo-graduation.png" alt="IG Nation">
      <span style="font-weight:700;font-size:1.25rem;">Mathematics Homework</span>
      <span class="subject-badge">Mathematics IGCSE</span>
    </a>
    <div class="homework-nav">
      <a href="course-mathematics.html" class="nav-btn"><iconify-icon icon="material-symbols:arrow-back"></iconify-icon>Back to Course</a>
      <a href="mathematics-quiz.html" class="nav-btn"><iconify-icon icon="material-symbols:quiz"></iconify-icon>Quizzes</a>
      <a href="mathematics-exam.html" class="nav-btn"><iconify-icon icon="material-symbols:quiz"></iconify-icon>Exams</a>
    </div>
  </div>

  <!-- Main -->
  <div class="main-content">
    <div class="homework-hero">
      <div class="homework-title">Mathematics Homework</div>
      <div class="homework-subtitle">Mathematics practice exercises and assignments</div>
      <div class="homework-stats">
        <div class="stat-item"><div class="stat-number" id="totalHomework">0</div><div class="stat-label">Available Assignments</div></div>
        <div class="stat-item"><div class="stat-number" id="completedHomework">0</div><div class="stat-label">Completed</div></div>
        <div class="stat-item"><div class="stat-number" id="averageScore">0%</div><div class="stat-label">Average Score</div></div>
      </div>
    </div>

    <!-- Filters -->
    <div class="homework-filters">
      <div class="filter-tabs">
        <button class="filter-tab active" onclick="filterHomework('all',event)">All Assignments</button>
        <button class="filter-tab" onclick="filterHomework('algebra',event)">Algebra</button>
        <button class="filter-tab" onclick="filterHomework('geometry',event)">Geometry</button>
        <button class="filter-tab" onclick="filterHomework('calculus',event)">Calculus</button>
        <button class="filter-tab" onclick="filterHomework('statistics',event)">Statistics</button>
      </div>
      <div class="search-box">
        <iconify-icon icon="material-symbols:search" class="search-icon"></iconify-icon>
        <input type="text" class="search-input" placeholder="Search assignments..." id="homeworkSearch">
      </div>
      <button onclick="createTestAssignment()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; margin-left: 10px;">Create Test Assignment</button>
    </div>

    <div class="homework-grid" id="homeworkGrid"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
  <script>
    let homework = [];
    let currentFilter = 'all';

    document.addEventListener('DOMContentLoaded', () => {
      console.log('Page loaded, starting homework loading...');
      
      // Debug: Check what's in localStorage
      console.log('=== DEBUGGING HOMEWORK PAGE ===');
      console.log('studentAssignments:', localStorage.getItem('studentAssignments'));
      console.log('teacherAssignments:', localStorage.getItem('teacherAssignments'));
      
      loadHomework();
      updateStats();
      document.getElementById('homeworkSearch').addEventListener('input', searchHomework);
      
    });

    function getPublishedHomework() {
      console.log('=== DEBUGGING HOMEWORK LOADING ===');
      const rawData = localStorage.getItem('studentAssignments');
      console.log('Raw studentAssignments from localStorage:', rawData);
      
      const allAssignments = JSON.parse(rawData) || [];
      console.log('Parsed assignments:', allAssignments);
      
      const publishedMath = allAssignments.filter(a => {
        const isPublished = a.published === true;
        const isMath = a.subject === 'mathematics';
        console.log(`Assignment "${a.title}": published=${isPublished}, subject=${a.subject}, isMath=${isMath}`);
        return isPublished && isMath;
      });
      
      console.log('Filtered published math assignments:', publishedMath);
      return publishedMath;
    }

    function loadHomework() {
      homework = getPublishedHomework();
      let list = homework;
      if (currentFilter !== 'all') {
        list = homework.filter(a => a.category === currentFilter);
      }

      const grid = document.getElementById('homeworkGrid');
      if (list.length === 0) {
        grid.innerHTML = `<div class="col-12 text-center py-5"><h4>No assignments found</h4><p class="text-muted">Try adjusting your filters or search terms.</p></div>`;
        updateStats();
        return;
      }

      grid.innerHTML = list.map(a => `
        <div class="homework-card">
          <div class="homework-card-header">
            <div class="homework-icon"><iconify-icon icon="material-symbols:assignment"></iconify-icon></div>
            <div>
              <div class="homework-card-title">${a.title}</div>
              <span class="status-badge status-${a.status}">${a.status.toUpperCase()}</span>
            </div>
          </div>
          <div class="homework-card-description">${a.description}</div>
          <div class="homework-details">
            <div class="detail-row"><span class="detail-label">Points:</span><span class="detail-value">${a.points}</span></div>
            <div class="detail-row"><span class="detail-label">Difficulty:</span><span class="detail-value">${a.difficulty.toUpperCase()}</span></div>
            <div class="detail-row"><span class="detail-label">Due Date:</span><span class="detail-value">${new Date(a.dueDate).toLocaleDateString()}</span></div>
            ${a.status === 'completed' ? `
            <div class="detail-row"><span class="detail-label">Your Score:</span><span class="detail-value" style="color:#28a745;font-weight:600;">${a.score}%</span></div>
            <div class="detail-row"><span class="detail-label">Time Spent:</span><span class="detail-value">${a.timeSpent} minutes</span></div>` : ''}
          </div>
          <div class="homework-actions">
            ${a.status === 'completed' ? `
              <button class="btn btn-outline" onclick="reviewHomework(${a.id})"><iconify-icon icon="material-symbols:visibility"></iconify-icon>Review</button>
              <button class="btn btn-primary" onclick="retakeHomework(${a.id})"><iconify-icon icon="material-symbols:refresh"></iconify-icon>Retake</button>
            ` : `
              <button class="btn btn-primary" onclick="startHomework(${a.id})"><iconify-icon icon="material-symbols:play-arrow"></iconify-icon>Start Assignment</button>
            `}
          </div>
        </div>
      `).join('');
      updateStats();
    }

    function filterHomework(category, ev) {
      currentFilter = category;
      document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
      ev.target.classList.add('active');
      loadHomework();
    }

    function updateStats() {
      const published = getPublishedHomework();
      const total = published.length;
      const completed = published.filter(h => h.status === 'completed').length;
      const average = completed > 0 ? Math.round(published.filter(h => h.status === 'completed').reduce((s,h)=>s+h.score,0)/completed) : 0;
      document.getElementById('totalHomework').textContent = total;
      document.getElementById('completedHomework').textContent = completed;
      document.getElementById('averageScore').textContent = average + '%';
    }

    function startHomework(id){ const a=homework.find(h=>h.id===id); if(a){ alert(`Starting assignment: ${a.title}`); } }
    function reviewHomework(id){ const a=homework.find(h=>h.id===id); if(a){ alert(`Reviewing assignment: ${a.title}`); } }
    function retakeHomework(id){ const a=homework.find(h=>h.id===id); if(a && confirm(`Retake "${a.title}"?`)){ startHomework(id);} }

    function searchHomework(e) {
      const term = e.target.value.toLowerCase();
      homework = getPublishedHomework().filter(a =>
        a.title.toLowerCase().includes(term) ||
        a.description.toLowerCase().includes(term) ||
        a.category.toLowerCase().includes(term) ||
        a.difficulty.toLowerCase().includes(term)
      );
      const grid=document.getElementById('homeworkGrid');
      if (homework.length===0){grid.innerHTML=`<div class="col-12 text-center py-5"><h4>No assignments found</h4></div>`; return;}
      grid.innerHTML=homework.map(a=>`
        <div class="homework-card">
          <div class="homework-card-header"><div class="homework-icon"><iconify-icon icon="material-symbols:assignment"></iconify-icon></div>
          <div><div class="homework-card-title">${a.title}</div><span class="status-badge status-${a.status}">${a.status.toUpperCase()}</span></div></div>
          <div class="homework-card-description">${a.description}</div>
        </div>`).join('');
    }
    
  </script>
</body>
</html>
