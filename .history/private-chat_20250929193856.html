<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Chat - IG Nation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .assistant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .assistant-info h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #333;
        }
        
        .assistant-role {
            color: #666;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }
        
        .status-text {
            color: #28a745;
            font-size: 0.9rem;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            margin: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: #007bff;
        }
        
        .message.assistant .message-avatar {
            background: #28a745;
        }
        
        .message-content {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .message.user .message-content {
            background: #007bff;
            color: white;
        }
        
        .message.assistant .message-content {
            background: white;
            color: #333;
            border: 1px solid #e9ecef;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.25rem;
        }
        
        .message.user .message-time {
            text-align: right;
        }
        
        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e9ecef;
            background: white;
        }
        
        .chat-input-form {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 0.75rem 1rem;
            resize: none;
            max-height: 100px;
            font-family: inherit;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .send-btn:hover {
            background: #0056b3;
        }
        
        .send-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .question-context {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .context-title {
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 0.5rem;
        }
        
        .context-question {
            color: #333;
            font-style: italic;
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-style: italic;
            margin-bottom: 1rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #666;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <!-- Chat Header -->
    <div class="chat-header">
        <div class="assistant-avatar" id="assistantAvatar">Dr. S</div>
        <div class="assistant-info">
            <h3 id="assistantName">Dr. Sarah Johnson</h3>
            <div class="assistant-role" id="assistantRole">Mathematics Teacher</div>
        </div>
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span class="status-text" id="statusText">Online</span>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container">
        <!-- Question Context -->
        <div id="questionContext" class="question-context" style="display: none;">
            <div class="context-title">Question Context</div>
            <div class="context-question" id="contextQuestionText"></div>
        </div>
        
        <!-- Chat Messages -->
        <div class="chat-messages" id="chatMessages">
            <div class="message assistant">
                <div class="message-avatar">Dr. S</div>
                <div>
                    <div class="message-content">
                        Hello! I'm Dr. Sarah Johnson, your mathematics teacher. How can I help you today?
                    </div>
                    <div class="message-time" id="welcomeTime"></div>
                </div>
            </div>
        </div>
        
        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="message-avatar">Dr. S</div>
            <span>Assistant is typing</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
        <!-- Chat Input -->
        <div class="chat-input-container">
            <form class="chat-input-form" onsubmit="sendMessage(event)">
                <textarea 
                    class="chat-input" 
                    id="messageInput" 
                    placeholder="Type your message here..."
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                ></textarea>
                <button type="submit" class="send-btn" id="sendBtn">
                    <iconify-icon icon="material-symbols:send"></iconify-icon>
                </button>
            </form>
        </div>
    </div>

    <script>
        let assistantId = '';
        let messageCount = 0;
        
        // Initialize chat
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            assistantId = urlParams.get('assistant');
            const question = urlParams.get('question');
            const assignment = urlParams.get('assignment');
            const subject = urlParams.get('subject');
            
            // Set assistant info
            const assistantInfo = getAssistantInfo(assistantId);
            document.getElementById('assistantName').textContent = assistantInfo.name;
            document.getElementById('assistantRole').textContent = assistantInfo.role;
            document.getElementById('assistantAvatar').textContent = assistantInfo.initials;
            document.getElementById('statusText').textContent = assistantInfo.status;
            
            // Show question context if available
            if (question) {
                document.getElementById('contextQuestionText').textContent = question;
                document.getElementById('questionContext').style.display = 'block';
            }
            
            // Set welcome message time
            document.getElementById('welcomeTime').textContent = new Date().toLocaleTimeString();
            
            // Auto-resize textarea
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
            });
        });
        
        function getAssistantInfo(assistantId) {
            const assistants = {
                'dr-sarah': {
                    name: 'Dr. Sarah Johnson',
                    role: 'Mathematics Teacher',
                    initials: 'Dr. S',
                    status: 'Online'
                },
                'mr-ahmed': {
                    name: 'Mr. Ahmed Hassan',
                    role: 'General Academic Tutor',
                    initials: 'Mr. A',
                    status: 'Away'
                },
                'prof-michael': {
                    name: 'Prof. Michael Chen',
                    role: 'Physics Teacher',
                    initials: 'Prof. M',
                    status: 'Online'
                },
                'dr-lisa': {
                    name: 'Dr. Lisa Rodriguez',
                    role: 'Chemistry Teacher',
                    initials: 'Dr. L',
                    status: 'Offline'
                }
            };
            
            return assistants[assistantId] || {
                name: 'Unknown Assistant',
                role: 'Teacher',
                initials: '?',
                status: 'Offline'
            };
        }
        
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage(event);
            }
        }
        
        function sendMessage(event) {
            event.preventDefault();
            
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate assistant response
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateResponse(message);
                addMessage(response, 'assistant');
            }, 1500 + Math.random() * 1000);
        }
        
        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const assistantInfo = getAssistantInfo(assistantId);
            const avatar = sender === 'user' ? 'You' : assistantInfo.initials;
            const avatarBg = sender === 'user' ? '#007bff' : '#28a745';
            
            messageDiv.innerHTML = `
                <div class="message-avatar" style="background: ${avatarBg}">${avatar}</div>
                <div>
                    <div class="message-content">${content}</div>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }
        
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        function generateResponse(userMessage) {
            const responses = [
                "I understand your question. Let me help you with that step by step.",
                "That's a great question! Here's how we can approach this problem...",
                "I can see you're working on this topic. Let me explain the concept first...",
                "This is a common area where students have questions. Let me break it down for you.",
                "I'll help you understand this better. Let's start with the basics...",
                "That's an interesting problem! Here's my approach to solving it...",
                "I can help you with that. Let me provide a detailed explanation...",
                "This is a good question that shows you're thinking critically. Here's what I think..."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
    </script>
</body>
</html>
