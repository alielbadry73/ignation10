<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Assistant - IG Nation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .header-title h5 {
            margin: 0;
            font-weight: 600;
        }

        .header-title p {
            margin: 0;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Main Container */
        .main-container {
            display: flex;
            height: calc(100vh - 73px);
            background: white;
        }

        /* Sidebar - Assistants List */
        .assistants-sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .sidebar-header h6 {
            margin: 0;
            font-weight: 700;
            color: #333;
        }

        .assistants-list {
            flex: 1;
            overflow-y: auto;
        }

        .assistant-item {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .assistant-item:hover {
            background: #f8f9fa;
        }

        .assistant-item.active {
            background: #e8f0fe;
            border-left: 4px solid #667eea;
        }

        .assistant-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
            position: relative;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .status-online {
            background: #10b981;
        }

        .status-offline {
            background: #94a3b8;
        }

        .assistant-info {
            flex: 1;
        }

        .assistant-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .assistant-role {
            font-size: 0.85rem;
            color: #64748b;
        }

        .assistant-specialization {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f0f2f5;
        }

        .chat-placeholder {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
        }

        .chat-placeholder iconify-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .chat-placeholder h4 {
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .chat-placeholder p {
            color: #94a3b8;
        }

        /* Active Chat */
        .active-chat {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .active-chat.show {
            display: flex;
        }

        .chat-contact-header {
            background: white;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .contact-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            flex-shrink: 0;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .contact-status {
            font-size: 0.85rem;
            color: #10b981;
        }

        .contact-status.offline {
            color: #94a3b8;
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e5e7eb' fill-opacity='0.2'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .message {
            display: flex;
            margin-bottom: 1rem;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 65%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            position: relative;
        }

        .message.received .message-bubble {
            background: white;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message.sent .message-bubble {
            background: #dcf8c6;
            border-bottom-right-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message-text {
            color: #1e293b;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 0.7rem;
            color: #64748b;
            margin-top: 0.5rem;
            text-align: right;
        }

        /* Input Area */
        .message-input-container {
            background: white;
            padding: 1rem 1.5rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            border: 1px solid #e9ecef;
            border-radius: 24px;
            padding: 0.75rem 1.25rem;
            font-size: 0.95rem;
            resize: none;
            max-height: 120px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .message-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .attach-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .attach-btn:hover {
            background: #e9ecef;
            color: #667eea;
        }

        /* Empty State */
        .no-assistants {
            text-align: center;
            padding: 3rem 2rem;
            color: #94a3b8;
        }

        .no-assistants iconify-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .assistants-sidebar {
                width: 100%;
                position: absolute;
                z-index: 10;
                height: 100%;
            }

            .assistants-sidebar.hidden {
                display: none;
            }

            .chat-area {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="chat-header">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()">
                <iconify-icon icon="material-symbols:arrow-back"></iconify-icon>
            </button>
            <div class="header-title">
                <h5 id="courseTitle">Course Assistants</h5>
                <p id="courseSubtitle">Get help from teaching assistants</p>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Assistants Sidebar -->
        <div class="assistants-sidebar" id="assistantsSidebar">
            <div class="sidebar-header">
                <h6>Available Assistants</h6>
            </div>
            <div class="assistants-list" id="assistantsList">
                <!-- Assistants will be loaded here -->
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area">
            <!-- Placeholder when no chat selected -->
            <div class="chat-placeholder" id="chatPlaceholder">
                <iconify-icon icon="material-symbols:chat"></iconify-icon>
                <h4>Select an Assistant to Start</h4>
                <p>Choose an assistant from the list to begin your conversation</p>
            </div>

            <!-- Active Chat -->
            <div class="active-chat" id="activeChat">
                <!-- Contact Header -->
                <div class="chat-contact-header">
                    <div class="contact-avatar" id="chatAvatar">
                        <!-- Avatar will be set dynamically -->
                    </div>
                    <div class="contact-info">
                        <div class="contact-name" id="chatName">Assistant Name</div>
                        <div class="contact-status" id="chatStatus">
                            <iconify-icon icon="material-symbols:circle" style="font-size: 0.6rem;"></iconify-icon>
                            Online
                        </div>
                    </div>
                </div>

                <!-- Messages -->
                <div class="messages-container" id="messagesContainer">
                    <!-- Messages will be loaded here -->
                </div>

                <!-- Input Area -->
                <div class="message-input-container">
                    <button class="attach-btn" onclick="attachFile()">
                        <iconify-icon icon="material-symbols:attach-file" style="font-size: 1.5rem;"></iconify-icon>
                    </button>
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Type a message..."
                        rows="1"
                        onkeydown="handleKeyPress(event)"
                    ></textarea>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                        <iconify-icon icon="material-symbols:send" style="font-size: 1.3rem;"></iconify-icon>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCourse = 'mathematics';
        let currentAssistant = null;
        let dashboardLink = 'mathematics-dashboard.html';

        // Detect course from URL or referrer
        function detectCourse() {
            const urlParams = new URLSearchParams(window.location.search);
            const course = urlParams.get('course');
            
            if (course) {
                currentCourse = course;
            } else {
                const referrer = document.referrer.toLowerCase();
                if (referrer.includes('physics')) {
                    currentCourse = 'physics';
                } else if (referrer.includes('english')) {
                    currentCourse = 'english';
                } else {
                    currentCourse = 'mathematics';
                }
            }

            // Set dashboard link
            dashboardLink = `${currentCourse}-dashboard.html`;

            // Update header
            const titles = {
                'mathematics': { title: 'Mathematics Assistants', subtitle: 'Get help with Mathematics' },
                'physics': { title: 'Physics Assistants', subtitle: 'Get help with Physics' },
                'english': { title: 'English Assistants', subtitle: 'Get help with English' }
            };

            document.getElementById('courseTitle').textContent = titles[currentCourse].title;
            document.getElementById('courseSubtitle').textContent = titles[currentCourse].subtitle;

            loadAssistants();
        }

        function loadAssistants() {
            const storageKey = `${currentCourse}Assistants`;
            const assistants = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const container = document.getElementById('assistantsList');

            console.log('Loading assistants for', currentCourse, ':', assistants.length);

            if (assistants.length === 0) {
                container.innerHTML = `
                    <div class="no-assistants">
                        <iconify-icon icon="material-symbols:group-off"></iconify-icon>
                        <p>No assistants available for this course yet.</p>
                        <small>Assistants will appear here once added by the teacher.</small>
                    </div>
                `;
                return;
            }

            // Render assistants
            container.innerHTML = assistants.map((assistant, index) => {
                const initials = assistant.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                const roleColors = {
                    'Senior Assistant': 'linear-gradient(135deg, #667eea, #764ba2)',
                    'Assistant': 'linear-gradient(135deg, #10b981, #059669)',
                    'Junior Assistant': 'linear-gradient(135deg, #f59e0b, #d97706)'
                };
                const bgColor = roleColors[assistant.role] || roleColors['Assistant'];
                const isOnline = Math.random() > 0.3; // Simulate online status

                return `
                    <div class="assistant-item" onclick="selectAssistant(${index})">
                        <div class="assistant-avatar" style="background: ${bgColor}">
                            ${initials}
                            <div class="status-indicator ${isOnline ? 'status-online' : 'status-offline'}"></div>
                        </div>
                        <div class="assistant-info">
                            <div class="assistant-name">${assistant.name}</div>
                            <div class="assistant-role">${assistant.role}</div>
                            <div class="assistant-specialization">${assistant.specialization}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectAssistant(index) {
            const storageKey = `${currentCourse}Assistants`;
            const assistants = JSON.parse(localStorage.getItem(storageKey) || '[]');
            currentAssistant = assistants[index];

            if (!currentAssistant) return;

            console.log('Selected assistant:', currentAssistant);

            // Update UI
            const items = document.querySelectorAll('.assistant-item');
            items.forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });

            // Show chat area
            document.getElementById('chatPlaceholder').style.display = 'none';
            document.getElementById('activeChat').classList.add('show');

            // Update chat header
            const initials = currentAssistant.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            const roleColors = {
                'Senior Assistant': 'linear-gradient(135deg, #667eea, #764ba2)',
                'Assistant': 'linear-gradient(135deg, #10b981, #059669)',
                'Junior Assistant': 'linear-gradient(135deg, #f59e0b, #d97706)'
            };
            const bgColor = roleColors[currentAssistant.role] || roleColors['Assistant'];
            const isOnline = Math.random() > 0.3;

            document.getElementById('chatAvatar').style.background = bgColor;
            document.getElementById('chatAvatar').textContent = initials;
            document.getElementById('chatName').textContent = currentAssistant.name;
            
            const statusEl = document.getElementById('chatStatus');
            if (isOnline) {
                statusEl.innerHTML = '<iconify-icon icon="material-symbols:circle" style="font-size: 0.6rem;"></iconify-icon> Online';
                statusEl.className = 'contact-status';
            } else {
                statusEl.innerHTML = '<iconify-icon icon="material-symbols:circle" style="font-size: 0.6rem;"></iconify-icon> Offline';
                statusEl.className = 'contact-status offline';
            }

            // Load messages
            loadMessages();
        }

        function loadMessages() {
            const chatKey = `chat_${currentCourse}_${currentAssistant.id}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            const container = document.getElementById('messagesContainer');

            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="message received">
                        <div class="message-bubble">
                            <div class="message-text">
                                Hello! I'm ${currentAssistant.name}. How can I help you with ${currentCourse} today?
                            </div>
                            <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}</div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = messages.map(msg => `
                    <div class="message ${msg.sender === 'student' ? 'sent' : 'received'}">
                        <div class="message-bubble">
                            <div class="message-text">${msg.text}</div>
                            <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}</div>
                        </div>
                    </div>
                `).join('');
            }

            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();

            if (!text || !currentAssistant) return;

            const chatKey = `chat_${currentCourse}_${currentAssistant.id}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');

            // Add new message
            const newMessage = {
                id: Date.now().toString(),
                sender: 'student',
                text: text,
                timestamp: new Date().toISOString()
            };

            messages.push(newMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));

            // Clear input
            input.value = '';
            input.style.height = 'auto';

            // Reload messages
            loadMessages();

            // Simulate assistant response (optional)
            setTimeout(() => {
                const responses = [
                    "I understand your question. Let me help you with that.",
                    "That's a great question! Here's what you need to know...",
                    "I can definitely help with that. Let me explain...",
                    "Good question! The key concept here is...",
                    "I'm happy to help! Let me break this down for you."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                messages.push({
                    id: Date.now().toString(),
                    sender: 'assistant',
                    text: randomResponse,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem(chatKey, JSON.stringify(messages));
                loadMessages();
            }, 1500);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function attachFile() {
            alert('File attachment feature coming soon!');
        }

        function goBack() {
            // Try to go back to referrer, otherwise to dashboard
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = dashboardLink;
            }
        }

        // Auto-resize textarea
        document.addEventListener('DOMContentLoaded', () => {
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            detectCourse();
        });
    </script>
</body>
</html>
















